<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PieGlyph">
<title>Compositional data example • PieGlyph</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compositional data example">
<meta property="og:description" content="PieGlyph">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PieGlyph</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/PieGlyph.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/time-series-example.html">Time-series example</a>
    <a class="dropdown-item" href="../articles/spatial-example.html">Spatial data example</a>
    <a class="dropdown-item" href="../articles/pie-lollipop-example.html">Pie-chart lollipop plots</a>
    <a class="dropdown-item" href="../articles/compositions-example.html">Compositional data example</a>
    <a class="dropdown-item" href="../articles/multinomial-classification-example.html">Multinomial Classification</a>
    <a class="dropdown-item" href="../articles/unusual-situations.html">Unusual Situations</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rishvish/PieGlyph/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compositional data example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rishvish/PieGlyph/blob/HEAD/vignettes/compositions-example.Rmd" class="external-link"><code>vignettes/compositions-example.Rmd</code></a></small>
      <div class="d-none name"><code>compositions-example.Rmd</code></div>
    </div>

    
    
<style type="text/css">
body {
  text-align: justify;
}

p {
  font-weight: 'normal';
  font-size: '16px;
  text-align: justify;
}

p.note {
  font-weight: 'normal';
  font-size: '12px;
  font-family: 'Serif';
  text-align: justify;
}
</style>
<p>
This example shows a use-case of the <code>PieGlyph</code> package with
compositional data. These datasets contain non-negative values giving
the relative information between different attributes of a particular
system. There is also often a constant-sum (usually sum to 1) constraint
on these values and they are often represented as proportions or
percentages.
</p>
<p>
The <code>PieGlyph</code> package work best with compositional data as
pie-charts are good at showing relative proportions.
</p>
<div class="section level3">
<h3 id="load-libraries">Load libraries<a class="anchor" aria-label="anchor" href="#load-libraries"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rishvish/PieGlyph" class="external-link">PieGlyph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DImodels</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eliocamp/metR" class="external-link">metR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eliocamp.github.io/ggnewscale/" class="external-link">ggnewscale</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<p>
We are using data from the <code>DImodels</code> package. This is a
package suitable for modelling the biodiversity and ecosystem
functioning (BEF) relationship using the Diversity-Interactions (DI)
modelling approach introduced by Kirwan et al. (2009) <a href="doi:10.1890/08-1684.1" class="uri">doi:10.1890/08-1684.1</a>.
</p>
<p>
We use the <code>sim4</code> dataset, which is a simulated dataset
showing the value of an ecosystem function (assumed to be yield) from an
ecosystem comprised of three species of plants. The response is shown as
we vary the proportions of the three species across the simplex space.
</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sim4</span><span class="op">)</span></span></code></pre></div>
<p>
The data consists of 141 rows and 9 columns. <code>richness</code> is a
numeric variable indicating the number of species in the community and
can take an integer value between 1 and 6 (inclusive). <code>p1</code>,
<code>p2</code>, <code>p3</code>, <code>p4</code>, <code>p5</code>, and
<code>p6</code> are the columns showing the initial proportions of the
six species and <code>response</code> is the simulated value of the
ecosystem function. <code>treatment</code> is assumed to be the level of
fertilizer applied to the communities and takes a value of either 50,
150 or 250. Further it is assumed that the six species in the experiment
are grouped depending on the function they perform in the ecosystem,
with species 1 and 2 grouped in functional group 1, species 3 and 4 in
functional group 2 and species 5 and 6 in functional group 3.
</p>
<p>
To simplify our example we only focus on communities receiving a
fertilizer treatment of 150.
</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw_data</span> <span class="op">&lt;-</span> <span class="va">sim4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="fl">150</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">raw_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   richness treatment p1 p2 p3 p4 p5 p6 response</span></span>
<span><span class="co">#&gt; 1        1       150  1  0  0  0  0  0   31.178</span></span>
<span><span class="co">#&gt; 2        1       150  1  0  0  0  0  0   28.986</span></span>
<span><span class="co">#&gt; 3        1       150  1  0  0  0  0  0   27.705</span></span>
<span><span class="co">#&gt; 4        1       150  0  1  0  0  0  0   19.540</span></span>
<span><span class="co">#&gt; 5        1       150  0  1  0  0  0  0   20.290</span></span>
<span><span class="co">#&gt; 6        1       150  0  1  0  0  0  0   20.305</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pie-scatter-plot">Pie-scatter plot<a class="anchor" aria-label="anchor" href="#pie-scatter-plot"></a>
</h3>
<p>
We can visualise the raw data as a scatterplot of response vs community,
where each point will be a pie-chart showing the proportions of the
three species.
</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">raw_data</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># Pie-charts </span></span>
<span>  <span class="fu"><a href="../reference/geom_pie_glyph.html">geom_pie_glyph</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">richness</span>, y <span class="op">=</span> <span class="va">response</span><span class="op">)</span>,</span>
<span>                 slices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'p1'</span>,<span class="st">'p2'</span>,<span class="st">'p3'</span>,<span class="st">'p4'</span>,<span class="st">'p5'</span>,<span class="st">'p6'</span><span class="op">)</span>,</span>
<span>                 colour <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># Axis and legend titles</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Richness'</span>, y <span class="op">=</span> <span class="st">'Response'</span>, fill <span class="op">=</span> <span class="st">'Species'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># Colours for segments of the pie-chart</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#8ecdf0'</span>, <span class="st">'#156c9e'</span>,<span class="st">'#ffb880'</span>,<span class="st">'#b34f00'</span>,<span class="st">'#dca3c2'</span>,<span class="st">'#81315e'</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="compositions-example_files/figure-html/raw-data-1.png" width="672" style="display: block; margin: auto;"></p>
<p>
This plot indicates that on average as we increase the richness of a
community, the response tends to increase. A possible reason for this
could be that as richness increase, the species interact with each other
which results in a positive effect on the response.
</p>
<p>
Further there also seem to be variation in the response within a given
richness level, which can be attributed to species composition and any
species-specific effects.
</p>
<p>
We can verify these observations by fitting a regression model which
expresses the response as a combination of species-specific effect and
species interactions.
</p>
<p>
We use the <code><a href="https://rdrr.io/pkg/DImodels/man/DI.html" class="external-link">DI()</a></code> function from the <code>DImodels</code>
package to fit this model. The <code><a href="https://rdrr.io/pkg/DImodels/man/DI.html" class="external-link">DI()</a></code> function allows us to
specify the structure of the interaction between species. We assume a
single common average interaction between all species and fit the model.
</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The parameters of the function are as follows:</span></span>
<span><span class="co"># y: name of column containing the response variable</span></span>
<span><span class="co"># DImodel: Structure of the interaction (average in this case)</span></span>
<span><span class="co"># prop: columns containing the six species proportions</span></span>
<span><span class="co"># data: data used to fit the model</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DImodels/man/DI.html" class="external-link">DI</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">'response'</span>, DImodel <span class="op">=</span> <span class="st">'AV'</span>,</span>
<span>         prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'p1'</span>,<span class="st">'p2'</span>,<span class="st">'p3'</span>,<span class="st">'p4'</span>,<span class="st">'p5'</span>,<span class="st">'p6'</span><span class="op">)</span>,</span>
<span>         data <span class="op">=</span> <span class="va">raw_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitted model: Average interactions 'AV' DImodel</span></span></code></pre></div>
<p class="note">
<b>Note:</b> Since this is a regression model we can also fit this model
using the regular <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> function. However that would
require us to manually calculate the interaction terms, the
<code><a href="https://rdrr.io/pkg/DImodels/man/DI.html" class="external-link">DI()</a></code> function automatically does that for us.
</p>
<p>
The model summary shows that all species-specific effects as well as the
average interaction effect are significant.
</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = fmla, family = family, data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -5.8627  -1.1832   0.1411   1.3792   5.6205  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; p1   30.298      1.319  22.972  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; p2   19.974      1.319  15.144  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; p3   22.381      1.319  16.969  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; p4   24.519      1.319  18.590  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; p5   13.155      1.319   9.974 2.08e-12 ***</span></span>
<span><span class="co">#&gt; p6   15.240      1.319  11.555 2.55e-14 ***</span></span>
<span><span class="co">#&gt; AV   23.068      2.509   9.193 2.06e-11 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 7.08006)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 31659.3  on 47  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:   283.2  on 40  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 233.79</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<p>
After fitting the model, a natural question that arises next would be
that ‘Which combination of species gives the best performance?’.
</p>
<p>
Another question of interest could be, ‘Is the high performance stable
over a large range of communities or restricted to only a small set of
communities?’.
</p>
<p>
We could make predictions from the model for different communities
across the simplex space and filter the best performing community. But
answering the question about stability is difficult.
</p>
<p>
A visualisation that shows both, the best performing community as well
as the stability across the simplex space would be really helpful.
</p>
<p>
This six species example is spread across the 6-d simplex, and
unfortunately it is very difficult to visualise anything over the 4-d
simplex. However, we could visualise the three functional groups of the
species, instead of their individual proportions. The three functional
groups are spread across the 3-d simplex space and that can be
visualised neatly as ternary diagram.
</p>
<p>
This can be thought of as a version of dimension reduction where the
species level information is combined and embedded within the functional
groups level. This reduces the dimensionality of the data, enabling us
to effectively visualise it.
</p>
</div>
<div class="section level3">
<h3 id="visualising-model-predictions">Visualising model predictions<a class="anchor" aria-label="anchor" href="#visualising-model-predictions"></a>
</h3>
<p>
Creating raw data for visualising the ternary diagram
</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create grid of points across 2-d space</span></span>
<span><span class="va">tern_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>base<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,l<span class="op">=</span><span class="fl">100</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                         high<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">pi</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,l<span class="op">=</span><span class="fl">87</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter out points which belong within the 3-d ternary</span></span>
<span><span class="va">tern_data</span> <span class="op">&lt;-</span> <span class="va">tern_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">high</span> <span class="op">&lt;</span> <span class="op">(</span><span class="va">base</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">pi</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                       <span class="va">high</span> <span class="op">&lt;</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">base</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">pi</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Map the 2-d points to 3-d ternary points and get species proportions</span></span>
<span><span class="va">tern_data</span> <span class="op">&lt;-</span> <span class="va">tern_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>FG2 <span class="op">=</span> <span class="va">high</span><span class="op">*</span><span class="fl">2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                       FG3 <span class="op">=</span> <span class="va">base</span> <span class="op">-</span> <span class="va">high</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                       FG1 <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">FG2</span> <span class="op">-</span> <span class="va">FG3</span>,</span>
<span>                       p1 <span class="op">=</span> <span class="va">FG1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                       p2 <span class="op">=</span> <span class="va">FG1</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                       p3 <span class="op">=</span> <span class="va">FG2</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                       p4 <span class="op">=</span> <span class="va">FG2</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                       p5 <span class="op">=</span> <span class="va">FG3</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                       p6 <span class="op">=</span> <span class="va">FG3</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m1</span>, newdata <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>
<code>p1</code>, <code>p2</code>, <code>p3</code>, <code>p4</code>,
<code>p5</code>, and <code>p6</code> are the columns showing the
proportions of the six species. <code>FG1</code> (FG1 = p1 + p2),
<code>FG2</code> (FG2 = p3 + p4), and <code>FG3</code>(FG3 = p5 + p6)
represent the proportions of the three functional groups.
<code>pred</code> is the predicted response for each community.
<code>base</code> and <code>high</code> are the 2-d mappings of the 3-d
simplex space for visualising the 3-d simplex in 2 dimensions.
</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tern_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;          base high FG2         FG3       FG1        p1        p2 p3 p4</span></span>
<span><span class="co">#&gt; 1 0.005025126    0   0 0.005025126 0.9949749 0.4974874 0.4974874  0  0</span></span>
<span><span class="co">#&gt; 2 0.010050251    0   0 0.010050251 0.9899497 0.4949749 0.4949749  0  0</span></span>
<span><span class="co">#&gt; 3 0.015075377    0   0 0.015075377 0.9849246 0.4924623 0.4924623  0  0</span></span>
<span><span class="co">#&gt; 4 0.020100503    0   0 0.020100503 0.9798995 0.4899497 0.4899497  0  0</span></span>
<span><span class="co">#&gt; 5 0.025125628    0   0 0.025125628 0.9748744 0.4874372 0.4874372  0  0</span></span>
<span><span class="co">#&gt; 6 0.030150754    0   0 0.030150754 0.9698492 0.4849246 0.4849246  0  0</span></span>
<span><span class="co">#&gt;            p5          p6     pred</span></span>
<span><span class="co">#&gt; 1 0.002512563 0.002512563 30.90583</span></span>
<span><span class="co">#&gt; 2 0.005025126 0.005025126 30.90795</span></span>
<span><span class="co">#&gt; 3 0.007537688 0.007537688 30.90948</span></span>
<span><span class="co">#&gt; 4 0.010050251 0.010050251 30.91043</span></span>
<span><span class="co">#&gt; 5 0.012562814 0.012562814 30.91080</span></span>
<span><span class="co">#&gt; 6 0.015075377 0.015075377 30.91059</span></span></code></pre></div>
<div class="section level5">
<h5 id="ternary-diagram-with-predictions-across-the-3-d-simplex">Ternary diagram with predictions across the 3-d simplex<a class="anchor" aria-label="anchor" href="#ternary-diagram-with-predictions-across-the-3-d-simplex"></a>
</h5>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># breaks for contour plot</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">tern_data</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tern_data</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tern_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tern_data</span>, </span>
<span>                    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">base</span>, y <span class="op">=</span> <span class="va">high</span>, fill <span class="op">=</span> <span class="va">pred</span>, z <span class="op">=</span> <span class="va">pred</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="co"># Tiling the ternary space </span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="co"># Add contour lines</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">'black'</span>, breaks <span class="op">=</span> <span class="va">breaks</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="co"># Add labels on the contour lines</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/metR/man/geom_text_contour.html" class="external-link">geom_text_contour</a></span><span class="op">(</span>skip<span class="op">=</span><span class="fl">0</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, </span>
<span>                        label.placer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/metR/man/label_placers.html" class="external-link">label_placer_fraction</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                        size<span class="op">=</span><span class="fl">4</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.02</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="co"># Add borders around the ternary</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>                                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                                     xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                                     yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                                     pred <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend<span class="op">=</span><span class="va">xend</span>, yend<span class="op">=</span><span class="va">yend</span><span class="op">)</span>,</span>
<span>                 linewidth<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="co"># Add labels for the ternary </span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                  high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                                  label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'FG1'</span>, <span class="st">'FG2'</span>, <span class="st">'FG3'</span><span class="op">)</span>,</span>
<span>                                  pred <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">label</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span>, fontface<span class="op">=</span><span class="st">'bold'</span>,</span>
<span>               nudge_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>, <span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="co"># Choose colours for the different regions in the contour</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_steps.html" class="external-link">scale_fill_stepsn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">8</span>, rev <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>                        breaks <span class="op">=</span> <span class="va">breaks</span>,</span>
<span>                        limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">breaks</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="co"># Make legend continous instead of categorical</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_bins.html" class="external-link">guide_bins</a></span><span class="op">(</span>frame.colour <span class="op">=</span> <span class="st">'black'</span>, </span>
<span>                               ticks.colour <span class="op">=</span> <span class="st">'black'</span>, </span>
<span>                               title <span class="op">=</span> <span class="st">'Prediction'</span>, </span>
<span>                               show.limits <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="co"># Get rid of original plot axes</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="co"># Adjust legend position and size</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span>,</span>
<span>            legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.075</span>, <span class="st">'npc'</span><span class="op">)</span>,</span>
<span>            legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.04</span>, <span class="st">'npc'</span><span class="op">)</span>,</span>
<span>            legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face<span class="op">=</span><span class="st">'bold'</span>,</span>
<span>                                        size <span class="op">=</span> <span class="fl">12</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tern_plot</span></span></code></pre></div>
<p><img src="compositions-example_files/figure-html/ternary-plot-1.png" width="672"></p>
<p>
This figure shows a contour map of the expected performance of
communities across the 3-d simplex of the three functional groups. It is
evident that the high performance of stable across a wide range of
communities.
</p>
</div>
<div class="section level5">
<h5 id="overlay-ternary-with-pie-charts">Overlay ternary with pie-charts<a class="anchor" aria-label="anchor" href="#overlay-ternary-with-pie-charts"></a>
</h5>
<p>
In order to identify the best performing community we can now overlay
this ternary diagram with pie-charts showing the proportions of the best
performing community.
</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the best performing community </span></span>
<span><span class="va">best_com</span> <span class="op">&lt;-</span> <span class="va">tern_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pred</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tern_plot</span> <span class="op">+</span></span>
<span>    <span class="co"># Add a new scale for colour the species proportions</span></span>
<span>    <span class="fu">ggnewscale</span><span class="fu">::</span><span class="fu"><a href="https://eliocamp.github.io/ggnewscale/reference/new_scale.html" class="external-link">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="co"># Add a pie-chart for the selected communities</span></span>
<span>    <span class="fu"><a href="../reference/geom_pie_glyph.html">geom_pie_glyph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">best_com</span>, radius <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                   slices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'p1'</span>,<span class="st">'p2'</span>,<span class="st">'p3'</span>,<span class="st">'p4'</span>,<span class="st">'p5'</span>,<span class="st">'p6'</span><span class="op">)</span>, </span>
<span>                   colour <span class="op">=</span> <span class="st">'black'</span>, alpha <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="co"># Colour the sectors of the pies</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#8ecdf0'</span>,<span class="st">'#156c9e'</span>,</span>
<span>                                <span class="st">'#ffb880'</span>,<span class="st">'#b34f00'</span>,</span>
<span>                                <span class="st">'#dca3c2'</span>,<span class="st">'#81315e'</span><span class="op">)</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">'Species'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># Adjust the legend of the species colours</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="compositions-example_files/figure-html/best-com-1.png" width="672"></p>
<p>
This shows that the best performing community community consists of the
species <code>p1</code>,<code>p2</code>,<code>p3</code>, and
<code>p4</code> in roughly equal proportions.
</p>
<p>
Thus even though the visualisation is at the functional group level
(linear combination of species), we can get species-level information
using these pie-charts.
</p>
<p>
We can also add pie-charts representing any specific communities whose
performance we might be interested to monitor.
</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select a random subset of communities </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">98765</span><span class="op">)</span></span>
<span><span class="va">com_interest</span> <span class="op">&lt;-</span> <span class="va">tern_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tern_plot</span> <span class="op">+</span></span>
<span>    <span class="co"># Add a new scale for colour the species proportions</span></span>
<span>    <span class="fu">ggnewscale</span><span class="fu">::</span><span class="fu"><a href="https://eliocamp.github.io/ggnewscale/reference/new_scale.html" class="external-link">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="co"># Add a pie-chart for the selected communities</span></span>
<span>    <span class="fu"><a href="../reference/geom_pie_glyph.html">geom_pie_glyph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">com_interest</span>, radius <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                   slices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'p1'</span>,<span class="st">'p2'</span>,<span class="st">'p3'</span>,<span class="st">'p4'</span>,<span class="st">'p5'</span>,<span class="st">'p6'</span><span class="op">)</span>, </span>
<span>                   colour <span class="op">=</span> <span class="st">'black'</span>, alpha <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="co"># Colour the sectors of the pies</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#8ecdf0'</span>, <span class="st">'#156c9e'</span>,</span>
<span>                                 <span class="st">'#ffb880'</span>,<span class="st">'#b34f00'</span>,</span>
<span>                                 <span class="st">'#dca3c2'</span>,<span class="st">'#81315e'</span><span class="op">)</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">'Species'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># Adjust legend of species colours</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="compositions-example_files/figure-html/random-com-1.png" width="672"></p>
<p>
This idea can be also generalized to other situations with compositional
data, where we reduce the dimensionality of the data by taking linear
combinations of the certain variables and then visualise those linear
combinations to get a general idea about the data. We could then overlay
the plot with pie-charts at specific locations to get information about
the original dimensions of the data. This could help us to reduce the
tradeoff between dimensionality reduction and axis-interpretablity and
visualise high dimensional data more effectively.
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rishabh Vishwakarma, Catherine Hurley, Caroline Brophy.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
